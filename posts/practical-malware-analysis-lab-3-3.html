<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Brett Lischalk | Practical Malware Analysis: Lab 3-3</title>
  <meta name="description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 3-3 malware.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Practical Malware Analysis: Lab 3-3">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://brettlischalk.com/posts/practical-malware-analysis-lab-3-3">
  <meta property="og:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 3-3 malware.">
  <meta property="og:site_name" content="Brett Lischalk">
  <meta property="og:image" content="http://brettlischalk.com/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://brettlischalk.com/posts/practical-malware-analysis-lab-3-3">
  <meta name="twitter:title" content="Practical Malware Analysis: Lab 3-3">
  <meta name="twitter:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 3-3 malware.">
  <meta name="twitter:image" content="http://brettlischalk.com/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="http://brettlischalk.com/feed.xml" type="application/rss+xml" rel="alternate" title="Brett Lischalk Last 10 blog posts" />

  <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-6246123062809579",
      enable_page_level_ads: true
    });
  </script>

  
    <link type="text/css" rel="stylesheet" href="/assets/dark.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="/" class="header-logo" title="Brett Lischalk">Brett Lischalk</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <span class="icon icon-android-person"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/blischalk" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/blischalk" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/brett-lischalk-3104537" target="_blank" title="LinkedIn">
          <span class="icon icon-social-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:brett@brettlischalk.com" target="_blank" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>Practical Malware Analysis: Lab 3-3</h1>
            <div class="article-list-footer">
              <span class="article-list-date">
                June 27, 2018
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  2 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/malware">malware</a>
                
                  <a href="/tag/analysis">analysis</a>
                
                  <a href="/tag/practical-malware-analysis">practical-malware-analysis</a>
                
                  <a href="/tag/reverse-engineering">reverse-engineering</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <h2 id="overview">Overview</h2>

<p>The Lab 3-3 malware that is to be analyized using basic dynamic
analysis techniques is:</p>

<ul>
  <li>Lab03-03.exe</li>
</ul>

<p>The following are the tasks required to complete the lab exercise:</p>

<h2 id="basic-dynamic-analysis">Basic Dynamic Analysis</h2>

<p>Before performing analysis of this malware, my lab environment was
setup to have an ubuntu vm with wireshark and inetsim running
along with a Windows XP vm running:</p>

<ul>
  <li>Process Explorer</li>
  <li>Procmon</li>
  <li>ApdateDNS</li>
</ul>

<p>The two vms were on an internal only network setup so they could see
each other on the network but could not communicate with anything
else.</p>

<p>Snapshots were taken in this ready state to allow for quick revert /
retry if necessary.</p>

<h2 id="lab-questions">Lab Questions</h2>

<h3 id="what-do-you-notice-when-monitoring-this-malware-with-process-explorer">What do you notice when monitoring this malware with Process Explorer?</h3>

<p>Viewing Process Explorer while executing the malware shows the malware
executes and exits quickly. I had to run this a couple times to see that
what was actually happening was Lab03-03.exe was spawning a process
called <code class="highlighter-rouge">svchost.exe</code> and exiting. This left <code class="highlighter-rouge">svchost.exe</code> as an
orphaned process. It is abnormal to have <code class="highlighter-rouge">svchost.exe</code> as an orphaned
processes as well as not being a child of <code class="highlighter-rouge">service.exe</code>.</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab03/Lab03-03-exe-procexplorer-orphan.png" alt="Lab03-03.exe Orphan svchost.exe" /></p>

<h3 id="can-you-identify-any-live-memory-modifications">Can you identify any live memory modifications?</h3>

<p>Comparing the strings of <code class="highlighter-rouge">svchost.exe</code> in memory and on disk with
Process Explorer reveals some significant differences. The on disk
version contains usual function names. Nothing out of the
ordinary. However, viewing the executable’s strings in memory reveals:</p>

<ul>
  <li>A log file named <code class="highlighter-rouge">practicalmalwareanalysis.log</code></li>
  <li>Keyboard symbols key names like SHIFT, ENTER, BACKSPACE, CAPS LOCK, etc.</li>
</ul>

<p><img src="/assets/PracticalMalwareAnalysis/Lab03/Lab03-03-exe-procexplorer-strings-on-disk.png" alt="Lab03-03.exe Orphan svchost.exe" />
<img src="/assets/PracticalMalwareAnalysis/Lab03/Lab03-03-exe-procexplorer-strings-in-mem.png" alt="Lab03-03.exe Orphan svchost.exe" /></p>

<h3 id="what-are-the-malwares-host-based-indicators">What are the malware’s host-based indicators?</h3>

<p>The log file <code class="highlighter-rouge">practicalmalwareanalysis.log</code> is created.</p>

<h3 id="what-is-the-purpose-of-this-program">What is the purpose of this program?</h3>

<p>This program is a keylogger that logs keystrokes to
<code class="highlighter-rouge">practicalmalwareanalysis.log</code>.</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab03/Lab03-03-exe-logfile.png" alt="Lab03-03.exe Logged Keys" /></p>

<h2 id="conclusion">Conclusion</h2>

<p>This was an interesting lab as it highlighted Processes Explorer’s
ability to compare strings in memory vs on disk. It also highlighted
useful things to look for with <code class="highlighter-rouge">svchost.exe</code> such as orphaned
<code class="highlighter-rouge">svchost.exe</code> processes and <code class="highlighter-rouge">svchost.exe</code> processes that are not
children of <code class="highlighter-rouge">service.exe</code>.</p>

          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Practical Malware Analysis: Lab 3-3 - http://brettlischalk.com/posts/practical-malware-analysis-lab-3-3 by @blischalk', 'newwindow', 'width=500, height=225'); return false;">
              <span class="icon icon-social-twitter"></span>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://brettlischalk.com/posts/practical-malware-analysis-lab-3-3', 'newwindow', 'width=500, height=500'); return false;">
              <span class="icon icon-social-facebook"></span>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=http://brettlischalk.com/posts/practical-malware-analysis-lab-3-3', 'newwindow', 'width=550, height=400'); return false;">
              <span class="icon icon-social-googleplus"></span>
            </a>
          </div>

          <a href="https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/" title="Offensive Security Certified Professional" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-oscp.png" />
          </a>
          <a href="https://www.offensive-security.com/information-security-certifications/osce-offensive-security-certified-expert/" title="Offensive Security Certified Expert" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-osce.png"" />
          </a>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script>
              (function() {
                  var d = document, s = d.createElement('script');
                  s.src = '//blischalkblog.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
        </article>
        <footer class="footer reveal">
  <p>
    Site content by: <a href="/about" title="About me">Brett Lischalk</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  <script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>


  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-4121143-2','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>
