<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Brett Lischalk | Practical Malware Analysis: Lab 1-3</title>
  <meta name="description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-3 malware.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Practical Malware Analysis: Lab 1-3">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://brettlischalk.com/posts/practical-malware-analysis-lab-1-3">
  <meta property="og:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-3 malware.">
  <meta property="og:site_name" content="Brett Lischalk">
  <meta property="og:image" content="http://brettlischalk.com/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://brettlischalk.com/posts/practical-malware-analysis-lab-1-3">
  <meta name="twitter:title" content="Practical Malware Analysis: Lab 1-3">
  <meta name="twitter:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-3 malware.">
  <meta name="twitter:image" content="http://brettlischalk.com/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="http://brettlischalk.com/feed.xml" type="application/rss+xml" rel="alternate" title="Brett Lischalk Last 10 blog posts" />

  
    <link type="text/css" rel="stylesheet" href="/assets/dark.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="/" class="header-logo" title="Brett Lischalk">Brett Lischalk</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <span class="icon icon-android-person"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/blischalk" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/blischalk" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/brett-lischalk-3104537" target="_blank" title="LinkedIn">
          <span class="icon icon-social-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:brett@brettlischalk.com" target="_blank" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>Practical Malware Analysis: Lab 1-3</h1>
            <div class="article-list-footer">
              <span class="article-list-date">
                August 27, 2017
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  3 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/malware">malware</a>
                
                  <a href="/tag/analysis">analysis</a>
                
                  <a href="/tag/practical-malware-analysis">practical-malware-analysis</a>
                
                  <a href="/tag/reverse-engineering">reverse-engineering</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p>This is my analysis of the malware for Lab01-03 from the Practical
Malware Analysis book exercises.</p>

<h2 id="overview">Overview</h2>

<p>The Lab 1-3 malware that is to be analyized using basic static
analysis techniques consists of the file <code class="highlighter-rouge">Lab01-03.exe</code>.</p>

<p>The following are the tasks required to complete the lab exercise:</p>

<h2 id="basic-static-analysis">Basic Static Analysis</h2>

<h3 id="virustotal">VirusTotal?</h3>

<p>Upload the Lab01-03.exe file to
<a href="http://www.virustotal.com">http://www.virustotal.com</a>. Does it match
any existing antivirus definitions?</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab01/Lab01-03-exe-virus-total.png" alt="Lab01-03.exe Virus Total" /></p>

<p>According to VirusTotal this malware has been seen before.</p>

<h3 id="packed-or-obfuscated">Packed or Obfuscated?</h3>

<p>Are there any indications that this file is packed or obfuscated? If
so, what are these indicators? If the file is packed, unpack it if
possible.</p>

<h4 id="strings">Strings</h4>

<p>We can start with <code class="highlighter-rouge">strings</code> to see how many legible strings can be
found in the executable:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">PS C:<span class="se">\U</span>sers<span class="se">\B</span>rett<span class="se">\D</span>esktop<span class="se">\P</span>ractical Malware Analysis Labs<span class="se">\B</span>inaryCollection<span class="se">\C</span>hapter_1L&gt; strings Lab01-03.exe

Strings v2.53 - Search <span class="k">for </span>ANSI and Unicode strings <span class="k">in </span>binary images.
Copyright <span class="o">(</span>C<span class="o">)</span> 1999-2016 Mark Russinovich
Sysinternals - www.sysinternals.com

<span class="o">!</span>Windows Program
<span class="nv">$PE</span>
b!@
<span class="sb">`</span>.rdata
@.data
<span class="nv">$s</span><span class="o">!</span>
<span class="p">;</span>Ot
<span class="o">(</span>Q@
KERNEL32.dll
LoadLibraryA
GetProcAddress
3Bt&gt;O
VQ<span class="o">(</span>8
2]&lt;,M

.. snip ..</code></pre></figure>

<p>Running <code class="highlighter-rouge">strings</code> seems to only reveal a few strings including
<code class="highlighter-rouge">LoadLibraryA</code> and <code class="highlighter-rouge">GetProcAddress</code>. Since these functions are often
called in packed malware and there are few other legible strings, it
is looking like this malware may be packed.</p>

<h4 id="peid">PEid</h4>

<p>When we run the executable through PEid we find that PEid has detected
the executable to be packed with <code class="highlighter-rouge">fsg 1.0 dulek/xt</code>.</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab01/Lab01-03-exe-peid.png" alt="Lab01-03.exe PEid" /></p>

<h4 id="peview">PEView</h4>

<p>Running the executable through PEView also leads us to suspect packing
as the normal “.text”, “.rdata”, etc. sections are not
present. Instead the sections are just called “SECTION”. “Virtual
Size” and “Raw Data Size” of the sections are also different in
significant amounts seeming to indicate that the executable will
expand the malware at runtime.</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab01/Lab01-03-exe-peview.png" alt="Lab01-03.exe PEview" /></p>

<h4 id="idapro">IDAPro</h4>

<p>Opening the executable in IDAPro warns that this
executable seems to be packed or obfuscated:</p>

<p><img src="/assets/PracticalMalwareAnalysis/Lab01/Lab01-03-exe-idapro.png" alt="Lab01-03.exe IDAPro" /></p>

<h4 id="upacking">Upacking</h4>

<p>Practical Malware Analysis has not taught how to deal with unpacking
<code class="highlighter-rouge">fsg 1.0 dulek/xt</code> at this point. A little googling seems to indicate
that some manual processes will be necessary. The process is not as
straightforward as just running an un-pack command like with <code class="highlighter-rouge">upx</code>. I
may attempt some of these manual processes at some point in the future
but I am going to leave that alone for now as the book has not covered
it.</p>

<h3 id="imports-hint-at-functionality">Imports Hint at Functionality?</h3>

<p>Because the only imports that are able to be viewed are <code class="highlighter-rouge">LoadLibraryA</code>
and <code class="highlighter-rouge">GetProcAddress</code>, a good idea of the functionality can not be
gleaned at this point.</p>

<h3 id="host--or-network-based-indicators">Host- or Network-Based Indicators?</h3>

<p>Because no legible strings can be found that would point toward host
or network based indicators it is not possible to find any good
indicators of this malware at this point.</p>

<h2 id="conclusion">Conclusion</h2>

<p>This concludes the analysis of the third malware of Lab 1 from the
Practical Malware Analysis book. A curve ball was thrown with this
malware utilizing a packer that is not covered in the book. After
looking at the appendix answers for this exercise, everything that
could be learned about this malware without knowledge of unpacking fsg
1.0 has been learned. The appendix says that the techniques for
further dealing with this malware will be covered in chapter 18. I’ll
update this article if I take a stab at researching and trying to
unpack it myself before getting to chapter 18.</p>

          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Practical Malware Analysis: Lab 1-3 - http://brettlischalk.com/posts/practical-malware-analysis-lab-1-3 by @blischalk', 'newwindow', 'width=500, height=225'); return false;">
              <span class="icon icon-social-twitter"></span>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://brettlischalk.com/posts/practical-malware-analysis-lab-1-3', 'newwindow', 'width=500, height=500'); return false;">
              <span class="icon icon-social-facebook"></span>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=http://brettlischalk.com/posts/practical-malware-analysis-lab-1-3', 'newwindow', 'width=550, height=400'); return false;">
              <span class="icon icon-social-googleplus"></span>
            </a>
          </div>

          <a href="https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/" title="Offensive Security Certified Professional" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-oscp.png" />
          </a>
          <a href="https://www.offensive-security.com/information-security-certifications/osce-offensive-security-certified-expert/" title="Offensive Security Certified Expert" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-osce.png"" />
          </a>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script>
              (function() {
                  var d = document, s = d.createElement('script');
                  s.src = '//blischalkblog.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
        </article>
        <footer class="footer reveal">
  <p>
    Site content by: <a href="/about" title="About me">Brett Lischalk</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  <script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>


  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-4121143-2','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>
