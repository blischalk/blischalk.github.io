<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title>Brett Lischalk | Practical Malware Analysis: Lab 1-1</title>
  <meta name="description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-1 malware.">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <meta property="og:title" content="Practical Malware Analysis: Lab 1-1">
  <meta property="og:type" content="website">
  <meta property="og:url" content="http://localhost:4000/posts/practical-malware-analysis-lab-1-1">
  <meta property="og:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-1 malware.">
  <meta property="og:site_name" content="Brett Lischalk">
  <meta property="og:image" content="http://localhost:4000/assets/og-image.jpg">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:url" content="http://localhost:4000/posts/practical-malware-analysis-lab-1-1">
  <meta name="twitter:title" content="Practical Malware Analysis: Lab 1-1">
  <meta name="twitter:description" content="Walkthrough of the processes followed to analyze the Practical Malware Analysis Lab 1-1 malware.">
  <meta name="twitter:image" content="http://localhost:4000/assets/og-image.jpg">

  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png">
  <link href="http://localhost:4000/feed.xml" type="application/rss+xml" rel="alternate" title="Brett Lischalk Last 10 blog posts" />

  
    <link type="text/css" rel="stylesheet" href="/assets/dark.css">
  
</head>

<body>
  <main role="main">
    <div class="grid grid-centered">
      <div class="grid-cell">
        <nav class="header-nav reveal">
  <a href="/" class="header-logo" title="Brett Lischalk">Brett Lischalk</a>
  <ul class="header-links">
    
      <li>
        <a href="/about" title="About me">
          <span class="icon icon-android-person"></span>
        </a>
      </li>
    
    
      <li>
        <a href="https://twitter.com/blischalk" target="_blank" title="Twitter">
          <span class="icon icon-social-twitter"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="https://github.com/blischalk" target="_blank" title="GitHub">
          <span class="icon icon-social-github"></span>
        </a>
      </li>
    
    
    
    
      <li>
        <a href="https://www.linkedin.com/in/brett-lischalk-3104537" target="_blank" title="LinkedIn">
          <span class="icon icon-social-linkedin"></span>
        </a>
      </li>
    
    
    
      <li>
        <a href="mailto:brett@brettlischalk.com" target="_blank" title="Email">
          <span class="icon icon-at"></span>
        </a>
      </li>
    
    
      <li>
        <a href="/feed.xml" target="_blank" title="RSS">
          <span class="icon icon-social-rss"></span>
        </a>
      </li>
    
  </ul>
</nav>

        <article class="article reveal">
          <header class="article-header">
            <h1>Practical Malware Analysis: Lab 1-1</h1>
            <div class="article-list-footer">
              <span class="article-list-date">
                August 24, 2017
              </span>
              <span class="article-list-divider">-</span>
              <span class="article-list-minutes">
                
                
                  4 minute read
                
              </span>
              <span class="article-list-divider">-</span>
              <div class="article-list-tags">
                
                  <a href="/tag/malware">malware</a>
                
                  <a href="/tag/analysis">analysis</a>
                
                  <a href="/tag/practical-malware-analysis">practical-malware-analysis</a>
                
                  <a href="/tag/reverse-engineering">reverse-engineering</a>
                
              </div>
            </div>
          </header>

          <div class="article-content">
            <p>I am beginning an new series of blog posts to document my research as
I work through the Practical Malware Analysis book and labs. This is
the first blog post in that series beginning with Lab 1-1.</p>

<h2 id="overview">Overview</h2>

<p>The Lab 1-1 malware that is to be analyized using basic static
analysis techniques consists of two files:</p>

<ul>
  <li>Lab01-01.exe</li>
  <li>Lab01-01.dll</li>
</ul>

<p>The following are the tasks required to complete the lab exercise:</p>

<h2 id="basic-static-analysis">Basic Static Analysis</h2>

<h3 id="virustotal">VirusTotal?</h3>

<p>Upload the files to
<a href="http://www.virustotal.com">http://www.virustotal.com</a>. Does either
file match any existing antivirus signatures?</p>

<p>Uploading both files to VirusTotal indicates that both the .exe and
.dll match existing signatures. This is depicted in the following
screen captures:</p>

<h4 id="lab01-01exe">Lab01-01.exe</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-exe-virus-total-1.png" alt="Lab01-01.exe Virus Total 1" />
<img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-exe-virus-total-2.png" alt="Lab01-01.exe Virus Total 2" /></p>

<h4 id="lab01-01dll">Lab01-01.dll</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-dll-virus-total-1.png" alt="Lab01-01.dll Virus Total 1" />
<img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-dll-virus-total-2.png" alt="Lab01-01.dll Virus Total 2" /></p>

<h3 id="compilation-time">Compilation Time?</h3>

<p>When where these files compiled?</p>

<p>Opening both the dll and exe in PEview should give an idea of when the
files were compiled.</p>

<h4 id="lab01-01exe-1">Lab01-01.exe</h4>

<p>The executable appears to have been compiled on December 19th, 2010 at
16:16:19 UTC (2010/12/19 Sun 16:16:19 UTC)</p>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-exe-peview-compile.png" alt="Lab01-01.exe PEView" /></p>

<h4 id="lab01-01dll-1">Lab01-01.dll</h4>

<p>The dll appears to have been compiled on December 19th, 2010 at
16:16:38 UTC (2010/12/19 Sun 16:16:38 UTC)</p>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-dll-peview-compile.png" alt="Lab01-01.dll PEView" /></p>

<p>Both the executable and dll compilation times are within a few seconds
from one another which seems to indicate that they were compiled in
the same compilation process.</p>

<h2 id="packed-or-obfuscated">Packed or Obfuscated?</h2>

<p>Are there any indications that either of these files is packed or
obfuscated? If so, what are these indicators?</p>

<h3 id="peid">PEid</h3>

<p>Opening both the executable and dll in PEid is a good first start to
check for packer usage:</p>

<h4 id="lab01-01exe-2">Lab01-01.exe</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-exe-peid.png" alt="Lab01-01.exe PEid" /></p>

<h4 id="lab01-01dll-2">Lab01-01.dll</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-dll-peid.png" alt="Lab01-01.dll PEid" /></p>

<p>Running the executable and dll through PEid doesnâ€™t show any signs of
a packer being used. PEid is able to determine that Microsoft Visual
C++ 6.0 appears to be the compiler that was used. The analysis of the
dll indicates that the subsystem is Win32 GUI so this seems to
indicate that there is a GUI component to this malware.</p>

<p>Another check that can be done to determine if packing or obfuscation
is taking place is the use of the <code class="highlighter-rouge">strings</code> utility:</p>

<h3 id="strings">Strings</h3>

<p>Running <code class="highlighter-rouge">strings</code> on the executable shows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">.. snip ..

CloseHandle
UnmapViewOfFile
IsBadReadPtr
MapViewOfFile
CreateFileMappingA
CreateFileA
FindClose
FindNextFileA
FindFirstFileA
CopyFileA
KERNEL32.dll
malloc
<span class="nb">exit
</span>MSVCRT.dll
kerne132.dll
kernel32.dll
.exe
C:<span class="se">\*</span>
C:<span class="se">\w</span>indows<span class="se">\s</span>ystem32<span class="se">\k</span>erne132.dll
Kernel32.
Lab01-01.dll
C:<span class="se">\W</span>indows<span class="se">\S</span>ystem32<span class="se">\K</span>ernel32.dll
WARNING_THIS_WILL_DESTROY_YOUR_MACHINE</code></pre></figure>

<p>There seems to be a decent amount of information returned. In the
scenario of a packed or obfuscated file, very few legible strings
would be found.</p>

<p>Doing the same on the dll shows:</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">.. snip ..

CloseHandle
Sleep
CreateProcessA
CreateMutexA
OpenMutexA
KERNEL32.dll
WS2_32.dll
strncmp
MSVCRT.dll
free
malloc
<span class="nb">exec
</span>sleep
hello
127.26.152.13
SADFHUHF

.. snip ..</code></pre></figure>

<p>While not as many strings are returned, there are still seems to be a
good amount of information returned. An ip address, exec, sleep, and
other functions are found.</p>

<h3 id="idapro">IDAPro</h3>

<p>Another technique that can be used to determine if the malware is
packed is to utilize IDAPro to see if the instructions seem reasonable
and if there is any evidence of jumping to a decoder stub:</p>

<h4 id="lab01-01exe-3">Lab01-01.exe</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-exe-idapro.png" alt="Lab01-01.exe IDAPro" /></p>

<h4 id="lab01-01dll-3">Lab01-01.dll</h4>

<p><img src="/assets/PracticalMalwareanalysis/Lab01/Lab01-01-dll-idapro.png" alt="Lab01-01.dll IDAPro" /></p>

<p>Looking at both the exe and dll within IDAPro show that the
instructions do not appear to jump to a decoder stub of any kind and
the instructions are clearly visible.</p>

<h2 id="imports-indicate-malware-functionality">Imports Indicate Malware Functionality?</h2>

<p>Do any imports hint at what this malware does? If so, which imports are they?</p>

<h4 id="lab01-01exe-4">Lab01-01.exe</h4>

<p>The imports of Lab01-01.exe contain:</p>

<ul>
  <li>CreateFileA</li>
  <li>FindNextFileA</li>
  <li>FindFirstFileA</li>
  <li>CopyFileA</li>
</ul>

<p>Based on the imports, the executable appears to:</p>

<ul>
  <li>Search for a file(s)</li>
  <li>Copies a file(s)</li>
</ul>

<h4 id="lab01-01dll-4">Lab01-01.dll</h4>

<p>The imports of Lab01-01.dll contain:</p>

<ul>
  <li>Sleep</li>
  <li>CreateProcessA</li>
  <li>CreateMutexA</li>
  <li>OpenMutexA</li>
  <li>CloseHandle</li>
  <li>socket</li>
  <li>inet_addr</li>
  <li>connect</li>
  <li>send</li>
  <li>recv</li>
  <li>closesocket</li>
</ul>

<p>Based on these imports it appears that:</p>

<ul>
  <li>A socket connection is made to an external server and data is sent
and received.</li>
  <li>A process is created</li>
  <li>That a process sleeps at some point</li>
</ul>

<h4 id="hypothesis">Hypothesis</h4>

<p>Based on the strings and imports it seems like this is a backdoor
program that creates a socket connection to 127.26.152.13. Usage /
tampering of kernel32 seems likely to occur as well based upon the
FindFile / FindFirstFile usage, the strings <code class="highlighter-rouge">C:\*</code>,
<code class="highlighter-rouge">C:\windows\system32\kerne132.dll</code>, and
<code class="highlighter-rouge">C:\windows\system32\kernel32.dll</code>.</p>

<h2 id="file-or-host-based-indicators">File or Host-Based Indicators?</h2>

<p>Are there any other files or host-based indicators that you could look
for on infected systems?</p>

<p>A file based indicator of this malware would be:
<code class="highlighter-rouge">C:\windows\system32\kerne132.dll</code>. Finding this file on a system
would likely indicate the presence of the malware.</p>

<h2 id="network-based-indicators">Network-Based Indicators?</h2>

<p>What network-based indicators could be used to find this malware on
infected machines?</p>

<p>Network activity to <code class="highlighter-rouge">127.26.152.13</code> would be a network-based indicator
of the malware being present on a system.</p>

<h2 id="purpose-of-files">Purpose of Files?</h2>

<p>What would you guess is the purpose of these files?</p>

<p>Based on the imports and strings in the exe and dll, it would appear
that the dll contains backdoor functionality and the exe is used to
run, infect, and or install the backdoor.</p>

<h2 id="conclusion">Conclusion</h2>

<p>It was really fun and interesting analyzing and reporting on the first
malware in this lab exercise. I look forward to doing again for
Lab01-02.exe.</p>

          </div>

          <div class="article-share">
            
            <a href="" title="Share on Twitter" onclick="window.open('https://twitter.com/home?status=Practical Malware Analysis: Lab 1-1 - http://localhost:4000/posts/practical-malware-analysis-lab-1-1 by @blischalk', 'newwindow', 'width=500, height=225'); return false;">
              <span class="icon icon-social-twitter"></span>
            </a>
            <a href="" title="Share on Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=http://localhost:4000/posts/practical-malware-analysis-lab-1-1', 'newwindow', 'width=500, height=500'); return false;">
              <span class="icon icon-social-facebook"></span>
            </a>
            <a href="" title="Share on Google+" onclick="window.open('https://plus.google.com/share?url=http://localhost:4000/posts/practical-malware-analysis-lab-1-1', 'newwindow', 'width=550, height=400'); return false;">
              <span class="icon icon-social-googleplus"></span>
            </a>
          </div>

          <a href="https://www.offensive-security.com/information-security-certifications/oscp-offensive-security-certified-professional/" title="Offensive Security Certified Professional" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-oscp.png" />
          </a>
          <a href="https://www.offensive-security.com/information-security-certifications/osce-offensive-security-certified-expert/" title="Offensive Security Certified Expert" target="_blank">
            <img src="/assets/offsec-student-certified-emblem-rgb-osce.png"" />
          </a>

          
            <div id="disqus_thread" class="article-comments"></div>
            <script>
              (function() {
                  var d = document, s = d.createElement('script');
                  s.src = '//blischalkblog.disqus.com/embed.js';
                  s.setAttribute('data-timestamp', +new Date());
                  (d.head || d.body).appendChild(s);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
          
        </article>
        <footer class="footer reveal">
  <p>
    Site content by: <a href="/about" title="About me">Brett Lischalk</a>.
  </p>
</footer>

      </div>
    </div>
  </main>
  <script type="text/javascript" src="/assets/vendor.js"></script>
<script type="text/javascript" src="/assets/application.js"></script>

<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.16/webfont.js"></script>
<script>
  WebFont.load({
    google: {
      families: ['Cormorant Garamond:700', 'Lato:300,400,700']
    }
  });
</script>


  <script>
    window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
    ga('create','UA-4121143-2','auto');ga('send','pageview')
  </script>
  <script src="https://www.google-analytics.com/analytics.js" async defer></script>


</body>
</html>
